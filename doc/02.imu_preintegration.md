# imu preintegration

TransformFusion 和 IMUPreintegration 类分析

这两个类共同构成了 LIO-SAM 系统中的**运动融合与状态估计模块**，分别负责不同层次的运动融合和状态优化。

## 1. TransformFusion 类 - 运动融合层

### 核心作用

**融合激光里程计和IMU里程计，提供连续稳定的位姿估计**

### 关键功能

1. **多源数据融合**：
   - 订阅激光里程计 (`lio_sam/mapping/odometry`)
   - 订阅IMU里程计 (`odomTopic+"_incremental"`)
   - 融合两种传感器的位姿估计

2. **时间同步与插值**：
   - 以激光里程计时间为基准
   - 计算IMU里程计在激光扫描期间的变化量
   - 将IMU变化量应用到激光位姿上

3. **坐标变换管理**：
   - 处理激光雷达到基座标的静态变换
   - 维护`map→odom`的静态变换
   - 发布`odom→base_link`的动态变换

4. **路径可视化**：
   - 发布IMU路径 (`lio_sam/imu/path`)
   - 定期清理旧路径点

## 2. IMUPreintegration 类 - 状态估计层

### 核心作用

**紧耦合的激光-IMU状态优化，实现高精度位姿估计**

### 关键功能

1. **预积分优化**：
   - 使用GTSAM的`PreintegratedImuMeasurements`
   - 构建IMU预积分因子
   - 处理IMU偏置变化

2. **因子图优化**：
   - 创建非线性因子图
   - 添加IMU因子、位姿因子、偏置因子
   - 使用ISAM2进行增量优化

3. **状态管理**：
   - 维护位姿、速度、偏置状态
   - 处理系统初始化和重定位
   - 故障检测与恢复

4. **多传感器融合**：
   - 融合IMU和激光里程计
   - 处理外参变换（IMU-Lidar）
   - 发布优化后的里程计
